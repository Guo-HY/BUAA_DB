# 系统设计报告

- q1:用户可以新增兴趣标签，但是兴趣标签不用表明是哪个用户创建的，用户也不用保存自己创建了哪些标签，这个时候还需要再E-R图中画出兴趣标签与用户的关系吗？

- q2:1-n的关系需要单独使用表存储吗

## 一、需求分析

makeFun社交平台是基于部分匿名消息和兴趣图谱的属于当代大学生的虚拟社交平台。在makeFun中用户可以无顾虑的表达自己，认知他人，交流兴趣和观点，获得精神共鸣和认同感。在交流中获取信息，并获得有质量的新关系。在元宇宙带来的社交新浪潮下，makeFun展现真实，有趣，温暖的社交面貌，致力于满足当代大学生的精神需求。

同时，makeFun还相信大众的力量，多数人的判断，和数字的智慧。所有的内容，分类，筛选，排序都由每一个用户决定和产生。在makeFun的社区中，给评论一个赞，它的排位会自动上升。贴一个tag给一个圈子，它会在整个网站的标签分类中出现。

### 1.需求描述

#### 个人信息管理功能

用户需要在注册页面上注册才能浏览网站的全部信息。用户注册并登录后，可以在个人主页上传自己的头像，该**头像会自动迁移为漫画风格**。用户还可以在个人主页修改自己的联系方式，查看自己的**好友**，查看回复过的**漂流瓶**与抛出过的**漂流瓶**。参与的**活动**与关注的活动与创建的活动，以及选择自己的**偏好tag**。

#### 社区功能

在makeFun的社区板块中有一系列的圈子，圈子是一系列类似主题帖子的集合，类似于贴吧，但是圈子中发帖与评论均是**匿名的**，用户只能互相看到各自的头像。 用户可以在社区板块中发起圈子，在圈子中发表帖子，并在帖子中发表评论。还可以给帖子或者评论点赞。用户还可以**给圈子添加tag**。makeFun平台会根据帖子的发表时间，赞个数，评论数对圈子中的帖子进行综合排序；根据圈子中的帖子个数，圈子tag与用户tag的匹配度对圈子进行综合排序；根据评论的发表时间，评论的赞数对帖子中的评论进行综合排序并呈现给用户。

#### 漂流瓶功能

在makeFun的漂流瓶板块中，用户可以跟陌生人交朋友，接收，投放漂流瓶。漂流瓶板块主要分为两个部分：发送与接收模块。在发送模块中用户可以匿名发送一个问题或者随想，系统会将它随机发送给别的用户。在接收模块中，有一系列系统随机选择的其它用户发放的漂流瓶，可以选择回答该漂流瓶或者不回答。若用户回答了一个漂流瓶，则发送漂流瓶的用户会收到该条回答消息与是否关注的提示。若选择关注，则漂流瓶的发送用户与评论用户会出现在各自的好友列表中，各自可以看到互相的个人信息，并进行私聊。

#### 私聊功能

当两个用户成为好友后可以进行私聊。具体而言，需要在个人主页的好友列表中选择好友并发送消息。若收到好友发送的消息，则在主页上会产生消息提示。

#### 活动功能

在makeFun的活动板块中，用户可以发布活动并关注，参与活动。对于发布活动，需要填写活动标题，时间，地点，类型，活动须知与活动详情。对于已经发布的活动，用户可以选择**参加**或者**关注**，活动中会显示参加或者关注的用户的用户头像。当活动时间过后，活动会自动删除。

### 2.数据流图

##### 顶层数据流图

![顶层数据流图.drawio](pictures/%E9%A1%B6%E5%B1%82%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE.drawio.svg)



##### 用户信息管理数据流图



##### 社区功能数据流图

##### 漂流瓶功能数据流图

##### 活动功能数据流图

##### 私信功能数据流图



### 3.数据元素表

### 实体表

#### 用户（user）

| 字段名称      | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明                       |
| ------------- | -------- | -------- | -------- | ---- | ---- | -------------------------- |
| user_id       | int      | 20       | 是       | 是   | 否   | 自增主键                   |
| name          | varchar  | 255      | 是       | 否   | 否   | 用户名,唯一                |
| password      | varchar  | 255      | 是       | 否   | 否   | 密码                       |
| head_portrait | varchar  | 255      | 否       | 否   | 否   | 存放头像在文件系统中的路径 |
| contact       | varchar  | 255      | 否       | 否   | 否   | 联系方式                   |

#### 圈子（group）

| 字段名称          | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明         |
| ----------------- | -------- | -------- | -------- | ---- | ---- | ------------ |
| group_id          | int      | 20       | 是       | 是   | 否   | 自增主键     |
| post_num          | int      | 20       | 是       | 否   | 否   | 帖子个数     |
| group_name        | varchar  | 255      | 是       | 否   | 否   | 圈子名       |
| group_description | varchar  | 1000     | 是       | 否   | 否   | 圈子描述     |
| user_id           | int      | 20       | 是       | 否   | 是   | 发起用户的id |

#### 帖子（post）

| 字段名称    | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明       |
| ----------- | -------- | -------- | -------- | ---- | ---- | ---------- |
| post_id     | int      | 20       | 是       | 是   | 否   | 自增主键   |
| name        | varchar  | 255      | 是       | 否   | 否   | 帖子名     |
| context     | varchar  | 10000    | 是       | 否   | 否   | 帖子内容   |
| post_time   | varchar  | 255      | 是       | 否   | 否   | 发帖时间   |
| comment_num | int      | 20       | 是       | 否   | 否   | 评论个数   |
| likes_num   | int      | 20       | 是       | 否   | 否   | 赞个数     |
| user_id     | int      | 20       | 是       | 否   | 是   | 发贴用户id |
| group_id    | int      | 20       | 是       | 否   | 是   | 所属圈子id |

#### 评论（comment）

| 字段名称     | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明             |
| ------------ | -------- | -------- | -------- | ---- | ---- | ---------------- |
| comment_id   | int      | 20       | 是       | 是   | 否   | 自增主键         |
| context      | varchar  | 10000    | 是       | 否   | 否   | 评论内容         |
| comment_time | varchar  | 255      | 是       | 否   | 否   | 评论时间         |
| likes_num    | int      | 20       | 是       | 否   | 否   | 赞个数           |
| user_id      | int      | 20       | 是       | 否   | 是   | 发表评论的用户id |
| post_id      | int      | 20       | 是       | 否   | 是   | 所属帖子id       |

#### 漂流瓶（bottle）

| 字段名称  | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明       |
| --------- | -------- | -------- | -------- | ---- | ---- | ---------- |
| bottle_id | int      | 20       | 是       | 是   | 否   | 自增主键   |
| context   | varchar  | 10000    | 是       | 否   | 否   | 漂流瓶内容 |
| user_id   | int      | 20       | 是       | 否   | 是   | 发送者id   |

#### 漂流瓶回复（bottle_reply）

| 字段名称        | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明             |
| --------------- | -------- | -------- | -------- | ---- | ---- | ---------------- |
| bottle_reply_id | int      | 20       | 是       | 是   | 否   | 自增主键         |
| context         | varchar  | 10000    | 是       | 否   | 否   | 回复内容         |
| user_id         | int      | 20       | 是       | 否   | 是   | 发起回复的用户id |
| bottle_id       | int      | 20       | 是       | 否   | 是   | 回复给的漂流瓶id |

#### 活动（activity）

| 字段名称    | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明         |
| ----------- | -------- | -------- | -------- | ---- | ---- | ------------ |
| activity_id | int      | 20       | 是       | 是   | 否   | 自增主键     |
| summary     | varchar  | 1000     | 是       | 否   | 否   | 活动概述     |
| begin_time  | varchar  | 255      | 是       | 否   | 否   | 活动开始时间 |
| end_time    | varchar  | 255      | 是       | 否   | 否   | 活动结束时间 |
| location    | varchar  | 255      | 是       | 否   | 否   | 活动地点     |
| user_id     | int      | 20       | 是       | 否   | 是   | 发起者id     |

#### 聊天消息（message）

| 字段名称   | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明     |
| ---------- | -------- | -------- | -------- | ---- | ---- | -------- |
| message_id | int      | 20       | 是       | 是   | 否   | 自增主键 |
| context    | varchar  | 255      | 是       | 否   | 否   | 消息内容 |
| send_time  | varchar  | 255      | 是       | 否   | 否   | 发送时间 |
| send_id    | int      | 20       | 是       | 否   | 是   | 发送者id |
| receive_id | int      | 20       | 是       | 否   | 是   | 接收者id |

#### 兴趣标签（label）

| 字段名称   | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明     |
| ---------- | -------- | -------- | -------- | ---- | ---- | -------- |
| label_id   | int      | 20       | 是       | 是   | 否   | 自增主键 |
| label_name | varchar  | 255      | 是       | 否   | 否   | 标签名   |

### 联系表

#### 用户点赞评论（user_like_comment）

| 字段名称   | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明         |
| ---------- | -------- | -------- | -------- | ---- | ---- | ------------ |
| user_id    | int      | 20       | 是       | 是   | 是   | 点赞用户id   |
| comment_id | int      | 20       | 是       | 是   | 是   | 被点赞评论id |

#### 用户点赞帖子（user_like_post）

| 字段名称 | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明         |
| -------- | -------- | -------- | -------- | ---- | ---- | ------------ |
| user_id  | int      | 20       | 是       | 是   | 是   | 点赞用户id   |
| post_id  | int      | 20       | 是       | 是   | 是   | 被点赞帖子id |

#### 用户具有的兴趣标签（user_label）

| 字段名称 | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明   |
| -------- | -------- | -------- | -------- | ---- | ---- | ------ |
| user_id  | int      | 20       | 是       | 是   | 是   | 用户id |
| label_id | int      | 20       | 是       | 是   | 是   | 标签id |

#### 圈子具有的兴趣标签（group_label）

| 字段名称 | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明   |
| -------- | -------- | -------- | -------- | ---- | ---- | ------ |
| group_id | int      | 20       | 是       | 是   | 是   | 圈子id |
| label_id | int      | 20       | 是       | 是   | 是   | 标签id |

#### 用户好友关系（user_user）

| 字段名称 | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明   |
| -------- | -------- | -------- | -------- | ---- | ---- | ------ |
| user1_id | int      | 20       | 是       | 是   | 是   | 用户id |
| user2_id | int      | 20       | 是       | 是   | 是   | 用户id |

#### 用户参与活动（user_activity）

| 字段名称    | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 说明   |
| ----------- | -------- | -------- | -------- | ---- | ---- | ------ |
| user_id     | int      | 20       | 是       | 是   | 是   | 用户id |
| activity_id | int      | 20       | 是       | 是   | 是   | 活动id |



## 二、数据库概念模式设计

### 1.系统实体E-R图

![部分E-R图.drawio](pictures/%E9%83%A8%E5%88%86E-R%E5%9B%BE.drawio.svg)

### 2.系统联系E-R图

![联系E-R图.drawio](pictures/%E8%81%94%E7%B3%BBE-R%E5%9B%BE.drawio.svg)

## 三、数据库逻辑模式设计



### 1.数据库关系模式

注：由E-R图得到的关系模式



### 2.关系模式范式等级的判定与规范化



### 3.数据库设计优化





